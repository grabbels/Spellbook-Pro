import{S as be,i as ke,s as ge,w as F,x as Z,y as j,f as N,t as S,z as G,a0 as H,o as ye,a4 as z,e as ue,b as $,g as J,d as K,h as f,k as g,q as A,a as B,l as y,m as I,r as L,c as O,n as v,a1 as b,N as q,u as Ee,a3 as x,ab as he,p as oe,a8 as Ie,a2 as se}from"../../../chunks/singletons-4e7778da.js";import{S as we,f as Ne,n as R,u as Se,p as fe,d as $e,m as De,s as Te,e as Ue,h as Ve}from"../../../chunks/stores-f5e17f9d.js";import{l as Be,b as Oe,v as Pe,w as Ae}from"../../../chunks/pill-9fbe8380.js";import{B as ee}from"../../../chunks/button-ad6f7d8d.js";import{S as Le}from"../../../chunks/saveslot-2b600b0a.js";import{L as Ce}from"../../../chunks/loading-47aa1dda.js";import{s as ne}from"../../../chunks/supabaseClient-e444a6b7.js";function _e(i,e,l){const t=i.slice();return t[30]=e[l],t}function He(i){let e,l,t,s,c,a,r,n;return c=new ee({props:{href:"/account/login",type:"outline",text:"Log in",icon:"ri-login-circle-line"}}),r=new ee({props:{href:"/account/login?register=true",type:"outline",text:"Register",icon:"ri-user-add-line"}}),{c(){e=g("div"),l=g("p"),t=A("You need to be logged in to use this page."),s=B(),F(c.$$.fragment),a=B(),F(r.$$.fragment),this.h()},l(p){e=y(p,"DIV",{class:!0});var k=I(e);l=y(k,"P",{});var h=I(l);t=L(h,"You need to be logged in to use this page."),h.forEach(f),s=O(k),Z(c.$$.fragment,k),a=O(k),Z(r.$$.fragment,k),k.forEach(f),this.h()},h(){v(e,"class","panel")},m(p,k){$(p,e,k),b(e,l),b(l,t),b(e,s),j(c,e,null),b(e,a),j(r,e,null),n=!0},p:q,i(p){n||(N(c.$$.fragment,p),N(r.$$.fragment,p),n=!0)},o(p){S(c.$$.fragment,p),S(r.$$.fragment,p),n=!1},d(p){p&&f(e),G(c),G(r)}}}function Me(i){let e,l,t,s,c,a,r,n,p,k,h,_,U,u,o,m,D,P,Q,C,W,V=i[7]&&me(i);const re=[ze,Ye,qe],M=[];function ae(E,T){return E[5].length<1?0:E[5]=="none"?1:2}h=ae(i),_=M[h]=re[h](i);let d=i[7]&&de(i),w=i[8]&&ve(i);return C=new ee({props:{text:"Change password",type:"fill",icon:"ri-lock-password-line"}}),C.$on("click",i[19]),{c(){e=g("div"),l=g("h2"),t=A("My Account"),s=B(),V&&V.c(),c=B(),a=g("div"),r=g("div"),n=g("h2"),p=A("Saved spellbooks"),k=B(),_.c(),U=B(),u=g("div"),o=g("h2"),m=A("Acccount information"),D=B(),d&&d.c(),P=B(),w&&w.c(),Q=B(),F(C.$$.fragment),this.h()},l(E){e=y(E,"DIV",{class:!0});var T=I(e);l=y(T,"H2",{class:!0});var X=I(l);t=L(X,"My Account"),X.forEach(f),s=O(T),V&&V.l(T),T.forEach(f),c=O(E),a=y(E,"DIV",{class:!0});var te=I(a);r=y(te,"DIV",{class:!0});var le=I(r);n=y(le,"H2",{class:!0});var ie=I(n);p=L(ie,"Saved spellbooks"),ie.forEach(f),k=O(le),_.l(le),le.forEach(f),U=O(te),u=y(te,"DIV",{class:!0});var Y=I(u);o=y(Y,"H2",{class:!0});var ce=I(o);m=L(ce,"Acccount information"),ce.forEach(f),D=O(Y),d&&d.l(Y),P=O(Y),w&&w.l(Y),Q=O(Y),Z(C.$$.fragment,Y),Y.forEach(f),te.forEach(f),this.h()},h(){v(l,"class","svelte-ll5v87"),v(e,"class","panel svelte-ll5v87"),v(n,"class","svelte-ll5v87"),v(r,"class","panel spellsheets svelte-ll5v87"),v(o,"class","svelte-ll5v87"),v(u,"class","panel details svelte-ll5v87"),v(a,"class","grid svelte-ll5v87")},m(E,T){$(E,e,T),b(e,l),b(l,t),b(e,s),V&&V.m(e,null),$(E,c,T),$(E,a,T),b(a,r),b(r,n),b(n,p),b(r,k),M[h].m(r,null),b(a,U),b(a,u),b(u,o),b(o,m),b(u,D),d&&d.m(u,null),b(u,P),w&&w.m(u,null),b(u,Q),j(C,u,null),W=!0},p(E,T){E[7]?V?V.p(E,T):(V=me(E),V.c(),V.m(e,null)):V&&(V.d(1),V=null);let X=h;h=ae(E),h===X?M[h].p(E,T):(J(),S(M[X],1,1,()=>{M[X]=null}),K(),_=M[h],_?_.p(E,T):(_=M[h]=re[h](E),_.c()),N(_,1),_.m(r,null)),E[7]?d?(d.p(E,T),T[0]&128&&N(d,1)):(d=de(E),d.c(),N(d,1),d.m(u,P)):d&&(J(),S(d,1,1,()=>{d=null}),K()),E[8]?w?(w.p(E,T),T[0]&256&&N(w,1)):(w=ve(E),w.c(),N(w,1),w.m(u,Q)):w&&(J(),S(w,1,1,()=>{w=null}),K())},i(E){W||(N(_),N(d),N(w),N(C.$$.fragment,E),W=!0)},o(E){S(_),S(d),S(w),S(C.$$.fragment,E),W=!1},d(E){E&&f(e),V&&V.d(),E&&f(c),E&&f(a),M[h].d(),d&&d.d(),w&&w.d(),G(C)}}}function me(i){let e,l,t,s;return{c(){e=g("h1"),l=A("Hi, "),t=A(i[7]),s=A("!")},l(c){e=y(c,"H1",{});var a=I(e);l=L(a,"Hi, "),t=L(a,i[7]),s=L(a,"!"),a.forEach(f)},m(c,a){$(c,e,a),b(e,l),b(e,t),b(e,s)},p(c,a){a[0]&128&&Ee(t,c[7])},d(c){c&&f(e)}}}function qe(i){let e,l,t=i[5],s=[];for(let a=0;a<t.length;a+=1)s[a]=pe(_e(i,t,a));const c=a=>S(s[a],1,1,()=>{s[a]=null});return{c(){e=g("div");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){e=y(a,"DIV",{class:!0});var r=I(e);for(let n=0;n<s.length;n+=1)s[n].l(r);r.forEach(f),this.h()},h(){v(e,"class","save_slots svelte-ll5v87")},m(a,r){$(a,e,r);for(let n=0;n<s.length;n+=1)s[n].m(e,null);l=!0},p(a,r){if(r[0]&32){t=a[5];let n;for(n=0;n<t.length;n+=1){const p=_e(a,t,n);s[n]?(s[n].p(p,r),N(s[n],1)):(s[n]=pe(p),s[n].c(),N(s[n],1),s[n].m(e,null))}for(J(),n=t.length;n<s.length;n+=1)c(n);K()}},i(a){if(!l){for(let r=0;r<t.length;r+=1)N(s[r]);l=!0}},o(a){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)S(s[r]);l=!1},d(a){a&&f(e),Ie(s,a)}}}function Ye(i){let e,l;return{c(){e=g("p"),l=A("You have no saved spellbooks yet!")},l(t){e=y(t,"P",{});var s=I(e);l=L(s,"You have no saved spellbooks yet!"),s.forEach(f)},m(t,s){$(t,e,s),b(e,l)},p:q,i:q,o:q,d(t){t&&f(e)}}}function ze(i){let e,l;return e=new Ce({}),{c(){F(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,s){j(e,t,s),l=!0},p:q,i(t){l||(N(e.$$.fragment,t),l=!0)},o(t){S(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}function pe(i){let e,l;return e=new Le({props:{data:i[30],type:"large"}}),{c(){F(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,s){j(e,t,s),l=!0},p(t,s){const c={};s[0]&32&&(c.data=t[30]),e.$set(c)},i(t){l||(N(e.$$.fragment,t),l=!0)},o(t){S(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}function de(i){let e,l,t,s,c,a,r,n,p,k;const h=[Fe,Re],_=[];function U(u,o){return u[1]?0:1}return a=U(i),r=_[a]=h[a](i),{c(){e=g("div"),l=g("form"),t=g("label"),s=A("Nickname"),c=B(),r.c(),this.h()},l(u){e=y(u,"DIV",{class:!0});var o=I(e);l=y(o,"FORM",{});var m=I(l);t=y(m,"LABEL",{for:!0,class:!0});var D=I(t);s=L(D,"Nickname"),D.forEach(f),c=O(m),r.l(m),m.forEach(f),o.forEach(f),this.h()},h(){v(t,"for","nickname"),v(t,"class","svelte-ll5v87"),v(e,"class","svelte-ll5v87")},m(u,o){$(u,e,o),b(e,l),b(l,t),b(t,s),b(l,c),_[a].m(l,null),n=!0,p||(k=x(l,"submit",he(i[14])),p=!0)},p(u,o){let m=a;a=U(u),a===m?_[a].p(u,o):(J(),S(_[m],1,1,()=>{_[m]=null}),K(),r=_[a],r?r.p(u,o):(r=_[a]=h[a](u),r.c()),N(r,1),r.m(l,null))},i(u){n||(N(r),n=!0)},o(u){S(r),n=!1},d(u){u&&f(e),_[a].d(),p=!1,k()}}}function Re(i){let e,l,t,s,c,a;return{c(){e=g("input"),l=B(),t=g("button"),s=g("i"),this.h()},l(r){e=y(r,"INPUT",{type:!0,name:!0,class:!0}),l=O(r),t=y(r,"BUTTON",{class:!0});var n=I(t);s=y(n,"I",{class:!0}),I(s).forEach(f),n.forEach(f),this.h()},h(){v(e,"type","text"),v(e,"name","nickname"),e.value=i[7],e.disabled=!0,v(e,"class","svelte-ll5v87"),v(s,"class","ri-edit-2-line svelte-ll5v87"),v(t,"class","edit svelte-ll5v87")},m(r,n){$(r,e,n),$(r,l,n),$(r,t,n),b(t,s),c||(a=x(t,"click",i[13]),c=!0)},p(r,n){n[0]&128&&e.value!==r[7]&&(e.value=r[7])},i:q,o:q,d(r){r&&f(e),r&&f(l),r&&f(t),c=!1,a()}}}function Fe(i){let e,l,t,s,c,a,r,n,p,k,h,_,U,u;return h=new ee({props:{text:"Cancel",type:"outline alt",icon:"ri-close-circle-line"}}),h.$on("click",i[12]),{c(){e=g("input"),l=B(),t=g("div"),s=g("button"),c=g("i"),a=A(`Save
										`),r=g("div"),n=g("i"),k=B(),F(h.$$.fragment),this.h()},l(o){e=y(o,"INPUT",{type:!0,name:!0,placeholder:!0,class:!0}),l=O(o),t=y(o,"DIV",{style:!0,class:!0});var m=I(t);s=y(m,"BUTTON",{class:!0,type:!0});var D=I(s);c=y(D,"I",{class:!0}),I(c).forEach(f),a=L(D,`Save
										`),r=y(D,"DIV",{class:!0});var P=I(r);n=y(P,"I",{class:!0}),I(n).forEach(f),P.forEach(f),D.forEach(f),k=O(m),Z(h.$$.fragment,m),m.forEach(f),this.h()},h(){e.required=!0,v(e,"type","text"),v(e,"name","nickname"),v(e,"placeholder","New nickname"),e.autofocus=!0,v(e,"class","svelte-ll5v87"),v(c,"class","ri-checkbox-circle-line svelte-ll5v87"),v(n,"class","ri-loader-5-line svelte-ll5v87"),v(r,"class","svelte-ll5v87"),v(s,"class",p=(i[0]?"loading":"")+" fill accent svelte-ll5v87"),v(s,"type","submit"),oe(t,"margin-bottom","1rem"),v(t,"class","svelte-ll5v87")},m(o,m){$(o,e,m),se(e,i[2]),$(o,l,m),$(o,t,m),b(t,s),b(s,c),b(s,a),b(s,r),b(r,n),b(t,k),j(h,t,null),_=!0,e.focus(),U||(u=x(e,"input",i[11]),U=!0)},p(o,m){m[0]&4&&e.value!==o[2]&&se(e,o[2]),(!_||m[0]&1&&p!==(p=(o[0]?"loading":"")+" fill accent svelte-ll5v87"))&&v(s,"class",p)},i(o){_||(N(h.$$.fragment,o),_=!0)},o(o){S(h.$$.fragment,o),_=!1},d(o){o&&f(e),o&&f(l),o&&f(t),G(h),U=!1,u()}}}function ve(i){let e,l,t,s,c,a,r,n,p,k;const h=[je,Ze],_=[];function U(u,o){return u[3]?0:1}return a=U(i),r=_[a]=h[a](i),{c(){e=g("div"),l=g("form"),t=g("label"),s=A("Email address"),c=B(),r.c(),this.h()},l(u){e=y(u,"DIV",{style:!0,class:!0});var o=I(e);l=y(o,"FORM",{});var m=I(l);t=y(m,"LABEL",{for:!0,class:!0});var D=I(t);s=L(D,"Email address"),D.forEach(f),c=O(m),r.l(m),m.forEach(f),o.forEach(f),this.h()},h(){v(t,"for","email"),v(t,"class","svelte-ll5v87"),oe(e,"margin-bottom","1rem"),v(e,"class","svelte-ll5v87")},m(u,o){$(u,e,o),b(e,l),b(l,t),b(t,s),b(l,c),_[a].m(l,null),n=!0,p||(k=x(l,"submit",he(i[18])),p=!0)},p(u,o){let m=a;a=U(u),a===m?_[a].p(u,o):(J(),S(_[m],1,1,()=>{_[m]=null}),K(),r=_[a],r?r.p(u,o):(r=_[a]=h[a](u),r.c()),N(r,1),r.m(l,null))},i(u){n||(N(r),n=!0)},o(u){S(r),n=!1},d(u){u&&f(e),_[a].d(),p=!1,k()}}}function Ze(i){let e,l,t,s,c,a;return{c(){e=g("input"),l=B(),t=g("button"),s=g("i"),this.h()},l(r){e=y(r,"INPUT",{type:!0,name:!0,class:!0}),l=O(r),t=y(r,"BUTTON",{class:!0});var n=I(t);s=y(n,"I",{class:!0}),I(s).forEach(f),n.forEach(f),this.h()},h(){v(e,"type","text"),v(e,"name","email"),e.value=i[8],e.disabled=!0,v(e,"class","svelte-ll5v87"),v(s,"class","ri-edit-2-line svelte-ll5v87"),v(t,"class","edit svelte-ll5v87")},m(r,n){$(r,e,n),$(r,l,n),$(r,t,n),b(t,s),c||(a=x(t,"click",i[17]),c=!0)},p(r,n){n[0]&256&&e.value!==r[8]&&(e.value=r[8])},i:q,o:q,d(r){r&&f(e),r&&f(l),r&&f(t),c=!1,a()}}}function je(i){let e,l,t,s,c,a,r,n,p,k,h,_,U,u;return h=new ee({props:{text:"Cancel",type:"outline alt",icon:"ri-close-circle-line"}}),h.$on("click",i[16]),{c(){e=g("input"),l=B(),t=g("div"),s=g("button"),c=g("i"),a=A(`Save
										`),r=g("div"),n=g("i"),k=B(),F(h.$$.fragment),this.h()},l(o){e=y(o,"INPUT",{type:!0,name:!0,placeholder:!0,class:!0}),l=O(o),t=y(o,"DIV",{style:!0,class:!0});var m=I(t);s=y(m,"BUTTON",{class:!0,type:!0});var D=I(s);c=y(D,"I",{class:!0}),I(c).forEach(f),a=L(D,`Save
										`),r=y(D,"DIV",{class:!0});var P=I(r);n=y(P,"I",{class:!0}),I(n).forEach(f),P.forEach(f),D.forEach(f),k=O(m),Z(h.$$.fragment,m),m.forEach(f),this.h()},h(){e.required=!0,v(e,"type","email"),v(e,"name","email"),v(e,"placeholder","New email"),e.autofocus=!0,v(e,"class","svelte-ll5v87"),v(c,"class","ri-checkbox-circle-line svelte-ll5v87"),v(n,"class","ri-loader-5-line svelte-ll5v87"),v(r,"class","svelte-ll5v87"),v(s,"class",p=(i[0]?"loading":"")+" fill accent svelte-ll5v87"),v(s,"type","submit"),oe(t,"margin-bottom","1rem"),v(t,"class","svelte-ll5v87")},m(o,m){$(o,e,m),se(e,i[4]),$(o,l,m),$(o,t,m),b(t,s),b(s,c),b(s,a),b(s,r),b(r,n),b(t,k),j(h,t,null),_=!0,e.focus(),U||(u=x(e,"input",i[15]),U=!0)},p(o,m){m[0]&16&&e.value!==o[4]&&se(e,o[4]),(!_||m[0]&1&&p!==(p=(o[0]?"loading":"")+" fill accent svelte-ll5v87"))&&v(s,"class",p)},i(o){_||(N(h.$$.fragment,o),_=!0)},o(o){S(h.$$.fragment,o),_=!1},d(o){o&&f(e),o&&f(l),o&&f(t),G(h),U=!1,u()}}}function Ge(i){let e,l,t,s;const c=[Me,He],a=[];function r(n,p){return n[6]?0:1}return e=r(i),l=a[e]=c[e](i),{c(){l.c(),t=ue()},l(n){l.l(n),t=ue()},m(n,p){a[e].m(n,p),$(n,t,p),s=!0},p(n,p){let k=e;e=r(n),e===k?a[e].p(n,p):(J(),S(a[k],1,1,()=>{a[k]=null}),K(),l=a[e],l?l.p(n,p):(l=a[e]=c[e](n),l.c()),N(l,1),l.m(t.parentNode,t))},i(n){s||(N(l),s=!0)},o(n){S(l),s=!1},d(n){a[e].d(n),n&&f(t)}}}function Je(i){let e,l;return e=new we({props:{name:"my-account",$$slots:{default:[Ge]},$$scope:{ctx:i}}}),{c(){F(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,s){j(e,t,s),l=!0},p(t,s){const c={};s[0]&511|s[1]&4&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(N(e.$$.fragment,t),l=!0)},o(t){S(e.$$.fragment,t),l=!1},d(t){G(e,t)}}}let Ke=/^[a-zA-Z0-9]*-?[a-zA-Z0-9]*$/;function Qe(i,e,l){let t,s,c,a,r,n,p;H(i,Ne,d=>l(5,t=d)),H(i,R,d=>l(21,s=d)),H(i,Oe,d=>l(22,d)),H(i,Se,d=>l(23,c=d)),H(i,fe,d=>l(24,a=d)),H(i,$e,d=>l(25,d)),H(i,De,d=>l(26,d)),H(i,Te,d=>l(6,r=d)),H(i,Ue,d=>l(7,n=d)),H(i,Ve,d=>l(8,p=d));let k=!1;ye(()=>{Be(c)}),z(fe,a="My account",a);let h=!1,_;async function U(){if(Ke.test(_)&&_.indexOf("-")!=0&&_.charAt(_.length-1)!="-"){l(0,k=!0);const{error:d,data:w}=await ne.from("nicknames").update({user_nickname:_}).eq("user_id",c).select();if(w){const{data:E,error:T}=await ne.auth.updateUser({data:{nickname:_}});T?(z(R,s="Oops, an error occurred. Error code: "+T.code+"#error",s),console.log(T),l(0,k=!1)):E&&(z(R,s="Nickname succesfully changed.#positive",s),l(0,k=!1),l(1,h=!1),Pe())}else d.code==23505?(z(R,s="The nickname is already in use, try another one!#error",s),l(0,k=!1)):d&&(z(R,s="Oops, an error occurred. Error code: "+d.code+"#error",s),console.log(d),l(0,k=!1))}else z(R,s="Your nickname may only contain letters, numbers and at most one hypen (not at the start or end).#alert",s)}let u=!1,o;async function m(){l(0,k=!0);const{data:d,error:w}=await ne.auth.updateUser({email:o});d?(z(R,s="Please confirm your email address change using the link that has just been emailed to you.#info",s),l(0,k=!1),l(3,u=!1)):w&&(z(R,s="Oops, an error occurred. Error code: "+w.code+"#error",s),console.log(w),l(0,k=!1))}function D(){_=this.value,l(2,_)}const P=()=>l(1,h=!1),Q=()=>l(1,h=!0),C=()=>{U()};function W(){o=this.value,l(4,o)}return[k,h,_,u,o,t,r,n,p,U,m,D,P,Q,C,W,()=>l(3,u=!1),()=>l(3,u=!0),()=>{m()},()=>Ae(p)]}class rt extends be{constructor(e){super(),ke(this,e,Qe,Je,ge,{},null,[-1,-1])}}export{rt as default};
